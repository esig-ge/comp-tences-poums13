{% extends "blog/base.html" %}

{% block title %}Planning – BarberWeb{% endblock %}

{% block content %}

<section class="content">
    <section class="card">
        <div class="card-header">
            <div>
                <h1>Planning de rendez-vous</h1>
            </div>
        </div>

        <div class="table-wrapper">
            <table class="table">
                <thead>
                <tr>
                    <th>Client</th>
                    <th>Date</th>
                    <th>Heure</th>
                    <th>Commentaires</th>
                    <th class="th-actions">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for appt in appointments %}
                    <tr>
                        <td><span class="client-name">{{ appt.client }}</span></td>
                        <td>{{ appt.date|date:"d/m/Y" }}</td>
                        <td>{{ appt.time|time:"H:i" }}</td>
                        <td>{{ appt.notes }}</td>
                        <td class="actions">
                            <!-- MODIFIER -->
                            <button type="button" class="btn small ghost"
                                    onclick="editAppointment({{ appt.id }}, '{{ appt.client }}',
                                                             '{{ appt.date }}', '{{ appt.time }}',
                                                             `{{ appt.notes|default:'' }}`)">
                                Modifier
                            </button>

                            <!-- SUPPRIMER -->
                            <form method="post" style="display:inline">
                                {% csrf_token %}
                                <input type="hidden" name="delete_id" value="{{ appt.id }}">
                                <button type="submit" class="btn small danger">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="5">Aucun rendez-vous pour l’instant.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <!-- FORMULAIRE AJOUT / MODIF -->
    <section class="card" id="form-section">
        <div class="card-header">
            <div><h2 id="form-title">Ajouter un rendez-vous</h2></div>
        </div>

        <form method="post" class="form-grid">
            {% csrf_token %}
            <!-- champ caché pour l'id -->
            <input type="hidden" name="id" id="form-id" value="">

            <div class="form-group">
                <label for="{{ form.client.id_for_label }}">Nom du client</label>
                {{ form.client }}
                {{ form.client.errors }}
            </div>

            <div class="form-group">
                <label for="{{ form.date.id_for_label }}">Date</label>
                {{ form.date }}
                {{ form.date.errors }}
            </div>

            <div class="form-group">
                <label for="{{ form.time.id_for_label }}">Heure</label>
                {{ form.time }}
                {{ form.time.errors }}
            </div>

            <div class="form-group full">
                <label for="{{ form.notes.id_for_label }}">Commentaires</label>
                {{ form.notes }}
                {{ form.notes.errors }}
            </div>

            <div class="form-actions">
                <button type="submit" class="btn primary">Enregistrer</button>
                <button type="button" class="btn ghost" onclick="resetForm()">Annuler</button>
            </div>
        </form>
    </section>
</section>

<script>
function editAppointment(id, client, date, time, notes) {
    document.getElementById("form-title").innerText = "Modifier un rendez-vous";
    document.getElementById("form-id").value = id;
    document.getElementById("id_client").value = client;
    document.getElementById("id_date").value = date;
    document.getElementById("id_time").value = time;
    document.getElementById("id_notes").value = notes;
    document.getElementById("form-section").scrollIntoView({behavior: 'smooth'});
}

function resetForm() {
    document.getElementById("form-title").innerText = "Ajouter un rendez-vous";
    document.getElementById("form-id").value = "";
    document.getElementById("id_client").value = "";
    document.getElementById("id_date").value = "";
    document.getElementById("id_time").value = "";
    document.getElementById("id_notes").value = "";
}
</script>

{% endblock %}
